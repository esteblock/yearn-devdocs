<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-developers docs-doc-id-v3/vault_management">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.21">
<link rel="search" type="application/opensearchdescription+xml" title="yearn.fi" href="/opensearch.xml">






<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"><title data-rh="true">Deploying and Managing a V3 Vault | yearn.fi</title><meta data-rh="true" property="og:image" content="https://docs.yearn.fi/img/YFILogoGradient.jpg"><meta data-rh="true" name="twitter:image" content="https://docs.yearn.fi/img/YFILogoGradient.jpg"><meta data-rh="true" property="og:url" content="https://docs.yearn.fi/developers/v3/vault_management"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="twitter:card" content="Yearn Finance is a suite of products in Decentralized Finance (DeFi) that provides lending aggregation, yield generation, and insurance on the Ethereum blockchain."><meta data-rh="true" name="git-url" content="https://github.com/yearn/yearn-devdocs"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-developers-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-developers-current"><meta data-rh="true" property="og:title" content="Deploying and Managing a V3 Vault | yearn.fi"><meta data-rh="true" name="description" content="V3 makes it as simple as possible for anyone to deploy and manage their Vaults. No longer will Yearn be the only manager of Vaults, gate-keeping who can be debt allocator, or what strategies should be added to a vault. Now, anyone can deploy, manage, and earn fees from their vision and preferences for everything from risk profile, fee model, decentralization, etc."><meta data-rh="true" property="og:description" content="V3 makes it as simple as possible for anyone to deploy and manage their Vaults. No longer will Yearn be the only manager of Vaults, gate-keeping who can be debt allocator, or what strategies should be added to a vault. Now, anyone can deploy, manage, and earn fees from their vision and preferences for everything from risk profile, fee model, decentralization, etc."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.yearn.fi/developers/v3/vault_management"><link data-rh="true" rel="alternate" href="https://docs.yearn.fi/developers/v3/vault_management" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.yearn.fi/developers/v3/vault_management" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://UNKNOWN-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.b5fe44b6.css">
<link rel="preload" href="/assets/js/runtime~main.ebb4e310.js" as="script">
<link rel="preload" href="/assets/js/main.be6ba45e.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="YFI Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="YFI Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Yearn Finance</b></a><a class="navbar__item navbar__link" href="/getting-started/intro">Getting Started</a><a class="navbar__item navbar__link" href="/developers/v2/getting-started">Develop</a><a class="navbar__item navbar__link" href="/vaults/smart-contracts/BaseStrategy">Smart Contracts</a><a class="navbar__item navbar__link" href="/partners/introduction">Partner</a><a class="navbar__item navbar__link" href="/contributing/contribute">Contribute</a><a class="navbar__item navbar__link" href="/resources/faq">Resources</a><a class="navbar__item navbar__link" href="/security/">Security</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/vaults/smart-contracts/BaseFeeOracle">0.4.6</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/vaults/smart-contracts/BaseFeeOracle">0.4.6</a></li><li><a class="dropdown__link" href="/vaults/0.4.5/smart-contracts/BaseFeeOracle">0.4.5</a></li><li><a class="dropdown__link" href="/vaults/0.4.3/smart-contracts/BaseStrategy">0.4.3</a></li><li><a class="dropdown__link" href="/vaults/0.4.2/getting-started">0.4.2</a></li><li><a class="dropdown__link" href="/vaults/0.3.5/getting-started">0.3.5</a></li><li><a class="dropdown__link" href="/vaults/0.3.4/getting-started">0.3.4</a></li><li><a class="dropdown__link" href="/vaults/0.3.3/getting-started">0.3.3</a></li><li><a class="dropdown__link" href="/vaults/0.3.2/getting-started">0.3.2</a></li><li><a class="dropdown__link" href="/vaults/0.3.1/getting-started">0.3.1</a></li><li><a class="dropdown__link" href="/vaults/0.3.0/getting-started">0.3.0</a></li></ul></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/img/logo.svg" alt="YFI Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="YFI Logo" class="themedImage_ToTc themedImage--dark_i4oU"><b>Yearn Finance</b></a><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/developers/v2/getting-started">Getting Started with Vaults and Strategies</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/developers/v2/additional-resources">Additional Resources</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/developers/v2/SPECIFICATION">Procedures</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/developers/v2/SPECIFICATION">Yearn System Specification</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/developers/v2/DEPLOYMENT">Deploying a Vault and Strategy V2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/developers/v2/OPERATIONS">Operations procedures</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/developers/v2/EMERGENCY">Emergency Procedures for Yearn Finance</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/developers/v2/naming-convention">Naming Conventions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/developers/v2/ledger-plugin">Ledger Plugin</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/vaults/smart-contracts/BaseStrategy">Smart Contracts</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/developers/v2/yearn-data">Yearn Data Services</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/developers/v2/yearn-data">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/developers/v2/subgraph-info">Subgraph Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/developers/v2/entities">Subgraph Entities</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/developers/v2/queries">Subgraph Queries</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/developers/v2/hacking-with-yearn">Hacking on Yearn</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/developers/v2/fork-yearn-ui">Fork Yearn UI: create a customized stablecoins-only vaults website</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/developers/v2/yswaps">ySwaps</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/developers/v3/overview">V3</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/developers/v3/overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/developers/v3/strategy_development">Guide to creating V3 &quot;Tokenized Strategies&quot;</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/developers/v3/protocol_fees">Protocol Fees</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/developers/v3/vault_management">Deploying and Managing a V3 Vault</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_GujU"><div class="docItemContainer_Adtb"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_aoJ5"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1 id="deploying-and-managing-a-v3-vault">Deploying and Managing a V3 Vault</h1><p>V3 makes it as simple as possible for anyone to deploy and manage their Vaults. No longer will Yearn be the only manager of Vaults, gate-keeping who can be debt allocator, or what strategies should be added to a vault. Now, anyone can deploy, manage, and earn fees from their vision and preferences for everything from risk profile, fee model, decentralization, etc.</p><p>In V3 our &quot;Meta Vaults&quot; or &quot;Vaults of Vaults&quot; are designed to be efficient 4626 compliant debt allocators that can have many different &quot;strategies&quot; attached to them and will direct funds to these strategies based on the vault&#x27;s management choice. The vaults are built to be &quot;plug and play&quot; meaning managers can simply deploy, add their strategies, and start the yield generation. But they also hold many customization factors, allowing different managers to differentiate themselves and experiment with different optionalities.</p><p>Running your vault requires no need to know how to code. Anyone desiring to manage their strategies and allocations can simply deploy and run their vault. </p><h2 id="definitions">Definitions</h2><ul><li><strong>vault</strong>: ERC-4626 compliant contract that accepts deposits, issues shares, and allocates funds to different strategies to earn yield.</li><li><strong>shares</strong>: A tokenized representation of a depositor&#x27;s share of the underlying balance of a vault.</li><li><strong>strategy</strong>: Any ERC-4626 compliant contract that can be added to a vault that earns yield on an underlying asset.</li><li><strong>debt</strong>: The amount of the underlying asset that a vault has sent to a strategy to earn yield.</li><li><strong>report</strong>: The function where a vault accounts for any profits or losses a strategy has accrued, charges applicable fees, and locks profit to be distributed to depositors.</li></ul><h2 id="deployment">Deployment</h2><p>Each release of the vaults will have its own &quot;Vault Factory&quot; deployed to make it as simple and trustless as possible to deploy your vault. The vault factory utilizes <a href="https://eips.ethereum.org/EIPS/eip-5202">ERC-5202</a> blueprint pattern to allow anyone to trustlessly deploy their vault which is an exact copy of the previously deployed &quot;blueprint&quot; vault for that specific version.</p><p>** Vaults not deployed through the factory will not be recognized as part of the Yearn ecosystem and may cause issues during runtime.</p><p>To deploy your vault, simply find the factory&#x27;s address for the most recent release here and call <code>Factory.deploy_new_vault(params)</code>.</p><p>The needed parameters are:</p><p><strong>asset</strong>: The ERC-20 compliant token used as the underlying asset to earn yield for the vault.
<strong>name</strong>: The name for your vault that will apply to the token issues to depositors.
<strong>symbol</strong>: The symbol the token issued to depositors will use.
<strong>role_manager</strong>: The address in charge of giving permissions to other addresses which allow access to certain permissioned functions.
<strong>profit_max_unlock_time</strong>: In seconds, profits reported from strategies will be unlocked.</p><p>The blueprint ERC standard lowers the gas cost compared to a traditional off-chain deployment, however, deployments of the vaults are still expected to be relatively expensive costing over 400k gas.</p><p>Once deployed, you can get your vault&#x27;s address from either the Factory function&#x27;s return value or the <code>NewVault</code> event emitted by the factory.</p><p>The vault should be automatically verified when deployed. However, if it is not you can follow the <a href="https://etherscan.io/verifyContract">verification steps</a> on Etherscan using the <a href="https://github.com/yearn/yearn-vaults-v3/blob/master/contracts/VaultV3.vy">VaultV3.vy</a> for your specific API Version.</p><p>NOTE: The vault factory utilizes <a href="https://eips.ethereum.org/EIPS/eip-1014">create2</a> opcode to deploy vaults to deterministic addresses. This means the same address can not deploy two vaults with the same default parameters for &#x27;asset&#x27;, &#x27;name&#x27; and &#x27;symbol&#x27;.</p><h2 id="setup">Setup</h2><p>Once deployed, additional setup steps and variables can be configured if desired.</p><h4 id="roles">Roles</h4><hr><p>The first is to set up the Roles for your specific vault. The vaults use a role-based system for access control to the permissioned functions. The roles are a <a href="https://docs.vyperlang.org/en/stable/types.html#enums">Vyper Enumerator</a> pattern based on Python. </p><p>Each permissioned function in the Vaults has its own &quot;role&quot; that can call that specific function. For example, to call <code>add_strategy(new_strategy: address)</code> the address must have the <code>ADD_STRATEGY_MANAGER</code> role. Roles can be held by any number of addresses or by no address. There is also the option to &quot;open&quot; any role, meaning the function becomes permissionless. (This is not recommended for most permissioned functions and should be done carefully.)</p><p>The same address can hold every role, each role can be helped by a different address or any combination desired.</p><p>To give an account a specific role can simply call <code>vault.set_role(account, role)</code> where &#x27;role&#x27; is the int representing all the roles you would like the &#x27;account&#x27; to hold. A full explanation of <a href="https://docs.python.org/3/howto/enum.html">python enumerators</a> is beyond the scope of this doc, but the corresponding int to each role can be viewed <a href="https://github.com/yearn/yearn-vaults-v3/blob/master/tests/utils/constants.py#L12">here</a></p><p>Example:</p><pre><code># Set `account` to be the ADD_STRATEGY_MANAGER
vault.set_role(account, 1)

# Set `account` to be the REVOKE_STRATEGY_MANAGER
vault.set_role(account, 2)

# Set `account` to be both the ADD_STRATEGY_MANAGER and REVOKE_STRATEGY_MANAGER
vault.set_role(account, 3)

# Set `account` to hold every role
vault.set_role(account, 8191)

# Set `account` to hold no roles
vault.set_role(account, 0)
</code></pre><p>NOTE: The vault <code>role_manager</code> can not call any permissioned function by default, and would have to give itself any roles that it should have.</p><h4 id="deposit-limit">Deposit Limit</h4><hr><p>Each vault will default to have a deposit limit set to 0. Which means all deposits will revert.</p><p>Once ready, the address with the DEPOSIT_LIMIT_MANAGER will need to call <code>vault.set_deposit_limit(deposit_limit)</code></p><h4 id="miscellaneous">Miscellaneous</h4><hr><p>There are other options that a vault manager can set that are not necessary for the vault to function but may be desired for further customization.</p><p><strong>minimum_total_idle</strong>: An amount specified in the underlying asset that the vault will force to remain free in the vault during debt updates to make servicing withdraws cheaper.
<strong>profit_max_unlock_time</strong>: The time in which profits reported by the strategies will be distributed to depositors. This can be adjusted to match the current report cycle of the vault&#x27;s strategies to create a continuous stream of APY paid out to depositors.</p><h2 id="running-the-vault">Running the Vault</h2><h4 id="strategy-management">Strategy Management</h4><p>The job of a vault is to manage debt between strategies that do the yield generation. 3 roles control what strategies are added to the vault, ADD_STRATEGY_MANAGER, REVOKE_STRATEGY_MANAGER, and FORCE_REVOKE_MANAGER. </p><p>A strategy can be any contract that has the needed <a href="https://github.com/yearn/yearn-vaults-v3/blob/master/contracts/VaultV3.vy#L39">4626 interface</a> for the vault to interact with it. This includes Tokenized Strategies, 3rd party 4626 vaults, and other Yearn meta vaults.</p><p>To add a strategy first call <code>vault.add_strategy(strategy_address)</code>. Each strategy gets added with a default &#x27;max_debt&#x27; of 0. This means the MAX_DEBT_MANAGER will need to call <code>vault.update_max_debt_for_strategy(strategy, max_debt)</code>.</p><p>Once a strategy has been added and given a max_debt, the DEBT_MANAGER role can allocate funds.</p><p>To remove a strategy, first remove all the debt from the strategy and then call <code>vault.revoke_strategy(strategy)</code>.</p><p>If a strategy has issues and cannot pay all of its debt back <code>vault.force_revoke_strategy(strategy)</code> can be used to forcefully remove the strategy.</p><p>NOTE: Forcefully removing a strategy that still has debt will cause a loss to be recorded and a reduction of Price Per Share.</p><h4 id="debt-updates">Debt Updates</h4><p>The DEBT_MANAGER role is in charge of allocating funds between the strategies added to a vault.</p><p>All debt updates are denominated in the underlying asset and are restricted by the <code>max_debt</code> for each strategy and the <code>minimum_total_idle</code> for the specific vault.</p><p>Debt updates will also respect the strategies specific <code>maxWithdraw</code> and <code>maxDeposit</code>.</p><p>To deposit or withdraw vault funds from a strategy simply call <code>vault.update_debt(strategy, desired_debt)</code> where desired debt is the end amount denominated in the underlying asset that the strategy should have after the full debt update.</p><p>NOTE: If a strategy has unrealized losses you cannot lower its debt.
NOTE: It is recommended to report a strategy&#x27;s gain before withdrawing 100% of debt from the strategy.</p><h4 id="reporting">Reporting</h4><p>To properly record any profits/losses from a strategy, charge fees, and lock profits for distribution to depositors, the REPORTING_MANAGER will need to &quot;report&quot; for each strategy via <code>vault.process_report(strategy)</code>.</p><p>This function will trigger all necessary logic to record a strategy&#x27;s gain since the last report and begin distributing that profit to depositors over the vault&#x27;s specific <code>profit_max_unlock_time</code>.</p><p>NOTE: To charge fees you will need first to have added an &#x27;accountant&#x27; to your vault that will hold the fee logic and receive the fees that are charged.</p><p><strong>NOTE: All profit and loss calculations use the strategies &#x27;convertToAssets&#x27; function. If this function can be manipulated it can lead to incorrect profits or losses being recorded by the vault</strong></p><h2 id="customization">Customization</h2><h4 id="accountant">Accountant</h4><p>You will need to add a separate contract as the vault&#x27;s &#x27;accountant&#x27; to charge fees.</p><p><code>vault.set_accountant(accountant)</code></p><p>The accountant is <a href="https://github.com/yearn/yearn-vaults-v3/blob/master/contracts/VaultV3.vy#L1070">called by the vault</a> during every <code>report</code> with the strategy that is reporting and the gain or loss it&#x27;s reporting. The accountant will then return the total fees or refunds that should be charged by the vault during that report and paid to the accountant.</p><p>Accountants can hold any logic that vault managers want to dictate fees or simply charge normal performance or management fees. A ready-to-use Generic Accountant can easily be used with any vault for those who wish just to charge standard fees.</p><p>See Here: <a href="https://github.com/yearn/vault-periphery/blob/master/contracts/accountants/GenericAccountant.vy">https://github.com/yearn/vault-periphery/blob/master/contracts/accountants/GenericAccountant.vy</a></p><h4 id="default-queue">Default Queue</h4><p>Each vault has a <code>default_queue</code> based on the strategies added and removed from the vault. The <code>default_queue</code> is used to service withdraws when no custom queue is passed. This queue is simply ordered by the time when strategies were added: where the oldest strategy is at the beginning of the queue.</p><p>If a different ordering is desired or management wants to remove a certain strategy from the default queue, the QUEUE_MANAGER role can set a new queue.</p><p><code>vault.set_default_queue(new_default_queue)</code></p><p>Where <code>new_default_queue</code> is an array of strategies with a max length of 10, in which all strategies are currently active in the vault.</p><h2 id="good-to-know">Good to Know</h2><h3 id="what-tokens-not-to-use">What Tokens Not to Use</h3><p>There are certain tokens whose native behavior makes them incompatible with being the underlying asset of a vault and should be avoided.</p><p>A few examples of this are:</p><ul><li>Rebasing Tokens</li><li>Fee on Transfer</li><li>Re-entrancy Tokens (ERC-777)</li></ul><p>Any token whose normal functionality breaks the ERC-20 standard may not be compatible with V3 vaults.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"></div><div class="col lastUpdated_vbeJ"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2023-09-05T20:26:27.000Z">9/5/2023</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/developers/v3/protocol_fees"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Protocol Fees</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#definitions" class="table-of-contents__link toc-highlight">Definitions</a></li><li><a href="#deployment" class="table-of-contents__link toc-highlight">Deployment</a></li><li><a href="#setup" class="table-of-contents__link toc-highlight">Setup</a></li><li><a href="#running-the-vault" class="table-of-contents__link toc-highlight">Running the Vault</a></li><li><a href="#customization" class="table-of-contents__link toc-highlight">Customization</a></li><li><a href="#good-to-know" class="table-of-contents__link toc-highlight">Good to Know</a><ul><li><a href="#what-tokens-not-to-use" class="table-of-contents__link toc-highlight">What Tokens Not to Use</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Developers</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://contribute.yearn.rocks/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Open Issues<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.gg/b8ENPNqG5c" target="_blank" rel="noopener noreferrer" class="footer__link-item">#strategies - Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Github</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/yearn/yearn-vaults" target="_blank" rel="noopener noreferrer" class="footer__link-item">yearn-vaults<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/yearn/brownie-strategy-mix" target="_blank" rel="noopener noreferrer" class="footer__link-item">brownie-strategy-mix<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/yearn/brownie-wrapper-mix" target="_blank" rel="noopener noreferrer" class="footer__link-item">brownie-wrapper-mix<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/yearn/yearn-watch" target="_blank" rel="noopener noreferrer" class="footer__link-item">yearn-watch<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/yearn/yearn-finance-v3" target="_blank" rel="noopener noreferrer" class="footer__link-item">yearn-finance-v3<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/yearn/yearn-security" target="_blank" rel="noopener noreferrer" class="footer__link-item">yearn-security<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Ecosystem</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://yearn.fi/vaults" target="_blank" rel="noopener noreferrer" class="footer__link-item">Vaults<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.yfistats.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">YFI Stats<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://bowswap.finance/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Bowswap<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/b8ENPNqG5c" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://x.com/yearnfi" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://t.me/yearnfinance/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Telegram<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://medium.com/iearn" target="_blank" rel="noopener noreferrer" class="footer__link-item">Medium<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://gov.yearn.fi" target="_blank" rel="noopener noreferrer" class="footer__link-item">Forum<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://snapshot.org/#/ybaby.eth" target="_blank" rel="noopener noreferrer" class="footer__link-item">Snapshot voting<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div></div></footer></div>
<script src="/assets/js/runtime~main.ebb4e310.js"></script>
<script src="/assets/js/main.be6ba45e.js"></script>
</body>
</html>