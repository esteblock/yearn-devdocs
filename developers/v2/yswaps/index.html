<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-developers docs-doc-id-v2/yswaps">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.21">
<link rel="search" type="application/opensearchdescription+xml" title="yearn.fi" href="/opensearch.xml">






<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"><title data-rh="true">ySwaps | yearn.fi</title><meta data-rh="true" property="og:image" content="https://docs.yearn.fi/img/YFILogoGradient.jpg"><meta data-rh="true" name="twitter:image" content="https://docs.yearn.fi/img/YFILogoGradient.jpg"><meta data-rh="true" property="og:url" content="https://docs.yearn.fi/developers/v2/yswaps"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="twitter:card" content="Yearn Finance is a suite of products in Decentralized Finance (DeFi) that provides lending aggregation, yield generation, and insurance on the Ethereum blockchain."><meta data-rh="true" name="git-url" content="https://github.com/yearn/yearn-devdocs"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-developers-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-developers-current"><meta data-rh="true" property="og:title" content="ySwaps | yearn.fi"><meta data-rh="true" name="description" content="This document contain links to private repositories that might not be publicly available"><meta data-rh="true" property="og:description" content="This document contain links to private repositories that might not be publicly available"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.yearn.fi/developers/v2/yswaps"><link data-rh="true" rel="alternate" href="https://docs.yearn.fi/developers/v2/yswaps" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.yearn.fi/developers/v2/yswaps" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://UNKNOWN-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.b5fe44b6.css">
<link rel="preload" href="/assets/js/runtime~main.6e30f117.js" as="script">
<link rel="preload" href="/assets/js/main.3dd8855a.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="YFI Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="YFI Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Yearn Finance</b></a><a class="navbar__item navbar__link" href="/getting-started/intro">Getting Started</a><a class="navbar__item navbar__link" href="/developers/v2/getting-started">Develop</a><a class="navbar__item navbar__link" href="/vaults/smart-contracts/BaseStrategy">Smart Contracts</a><a class="navbar__item navbar__link" href="/partners/introduction">Partner</a><a class="navbar__item navbar__link" href="/contributing/contribute">Contribute</a><a class="navbar__item navbar__link" href="/resources/faq">Resources</a><a class="navbar__item navbar__link" href="/security/">Security</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/vaults/smart-contracts/BaseFeeOracle">0.4.6</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/vaults/smart-contracts/BaseFeeOracle">0.4.6</a></li><li><a class="dropdown__link" href="/vaults/0.4.5/smart-contracts/BaseFeeOracle">0.4.5</a></li><li><a class="dropdown__link" href="/vaults/0.4.3/smart-contracts/BaseStrategy">0.4.3</a></li><li><a class="dropdown__link" href="/vaults/0.4.2/getting-started">0.4.2</a></li><li><a class="dropdown__link" href="/vaults/0.3.5/getting-started">0.3.5</a></li><li><a class="dropdown__link" href="/vaults/0.3.4/getting-started">0.3.4</a></li><li><a class="dropdown__link" href="/vaults/0.3.3/getting-started">0.3.3</a></li><li><a class="dropdown__link" href="/vaults/0.3.2/getting-started">0.3.2</a></li><li><a class="dropdown__link" href="/vaults/0.3.1/getting-started">0.3.1</a></li><li><a class="dropdown__link" href="/vaults/0.3.0/getting-started">0.3.0</a></li></ul></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/img/logo.svg" alt="YFI Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="YFI Logo" class="themedImage_ToTc themedImage--dark_i4oU"><b>Yearn Finance</b></a><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/developers/v2/getting-started">Getting Started with Vaults and Strategies</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/developers/v2/additional-resources">Additional Resources</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/developers/v2/SPECIFICATION">Procedures</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/developers/v2/SPECIFICATION">Yearn System Specification</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/developers/v2/DEPLOYMENT">Deploying a Vault and Strategy V2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/developers/v2/OPERATIONS">Operations procedures</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/developers/v2/EMERGENCY">Emergency Procedures for Yearn Finance</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/developers/v2/naming-convention">Naming Conventions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/developers/v2/ledger-plugin">Ledger Plugin</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/vaults/smart-contracts/BaseStrategy">Smart Contracts</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/developers/v2/yearn-data">Yearn Data Services</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/developers/v2/yearn-data">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/developers/v2/subgraph-info">Subgraph Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/developers/v2/entities">Subgraph Entities</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/developers/v2/queries">Subgraph Queries</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/developers/v2/hacking-with-yearn">Hacking on Yearn</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/developers/v2/fork-yearn-ui">Fork Yearn UI: create a customized stablecoins-only vaults website</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/developers/v2/yswaps">ySwaps</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/developers/v3/overview">V3</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/developers/v3/overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/developers/v3/strategy_writing_guide">Guide to creating V3 &quot;Tokenized Strategies&quot;</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/developers/v3/protocol_fees">Protocol Fees</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/developers/v3/vault_management">Deploying and Managing a V3 Vault</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_GujU"><div class="docItemContainer_Adtb"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_aoJ5"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1 id="yswaps">ySwaps</h1><p><em>This document contain links to private repositories that might not be publicly available</em></p><p>ySwaps is used to <strong>abstract</strong> the token trading logic from the strategies harvest method, which means strategies can focus on farming tokens and don&#x27;t have to handle tokens trading logic and paths. The &quot;swappers&quot; smart contracts allows trading optimizations and new paths to be added since the code is not hardcoded in strategies.</p><ul><li><a href="https://github.com/yearn/yswaps">ySwaps contracts repository</a></li><li><a href="https://github.com/yearn/yswaps-app">ySwaps scripts repository</a></li></ul><p><img src="https://i.imgur.com/VynhCU4.png" alt="yswaps-intro-diagram"></p><h2 id="glossary">Glossary</h2><ul><li><code>sms</code>: Strategists multisig</li><li><code>tokenIn</code>:  Token we have and we want to trade/swap</li><li><code>toeknOut</code>: Token we want to obtain on the swap</li><li><code>hopToken</code>: Token we use as a middle step between tokenIn and tokenOut</li><li><code>tf</code>: Trade Factory</li></ul><h2 id="components">Components</h2><ul><li><a href="#swappers">Swappers</a></li><li><a href="#trade-factory">Trade Factory</a></li><li><a href="#solvers-scripts">Solvers Scripts</a></li><li><a href="#dexes-libraries">Dexes Libraries</a></li><li><a href="#execute-script">Execute Script</a></li><li><a href="#extra-toolings">Extra Toolings</a></li><li><a href="#procedures">Procedures</a></li><li><a href="#keep3r-jobs">Keep3r Jobs</a></li></ul><h3 id="swappers">Swappers</h3><p>Contracts in charge of making the swaps (uniswap, balancer, sushiswap, solidly and more). We can separated them in two types:</p><h4 id="single-swapper">Single swapper</h4><p>Uniswap, balancer, sushiswap, etc. These are straighforward contracts that will make a simple swap on these dexes (<code>token A</code> to <code>token B</code>). It is also worth to mention that these swappers take care of few extra stuff like: <code>approval needed to make the swap</code>, <code>transfering final tokens to strategy if needed</code>.</p><h4 id="multicall-swapper">Multicall swapper</h4><p>This contract will receive a bundle of transactions that are required to aquire the wanted token/tokens. This is used in specific cases where trade can not be made in a normal exchange due to liquidity issues, dex not having that token or route, needing extra steps to aquire the token such as depositing or withdrawing, and more. It is important to mention that this swapper does NOT take care of things like approvals, or transfers (important difference with <code>single swappers</code>).</p><h4 id="swappers-usage">Swappers Usage</h4><p><strong>Single swapper example:</strong> We have <code>tokenIn</code> and <code>tokenOut</code> and we know that we can go straight to sushiswap that has enought liquidity to make the trade with good conditions.</p><p><strong>Multicall example:</strong> We have a <code>tokenIn</code> and we want a <code>tokenOut</code>. But theres no path on any dex to do the trade directly, so we need to split the swap in two steps:  </p><ol><li>Step 1: <code>tokenIn</code> for <code>hopToken</code>.  </li><li>Step 2: <code>hopToken</code> for <code>tokenOut</code>.  </li></ol><p>For this example we are gonna assume that we will need to use two different dexes for each step. Since we are gonna split the trade in two different transactions and the main objective is to use TWO DIFFERENT dexes, this is where we use the <code>Multicall Swapper</code>.Everything that requires more than just a single swap tx, will use multicall dexes.</p><h4 id="swapper-contracts-version-020">Swapper Contracts (version 0.2.0)</h4><h5 id="ethereum">Ethereum</h5><ul><li>MultiCallOptimizedSwapper: <a href="https://etherscan.io/address/0x711d1D8E8B2b468c92c202127A2BBFEFC14bf105">0x711d1D8E8B2b468c92c202127A2BBFEFC14bf105</a></li><li>ZRX <a href="https://etherscan.io/address/0xE32dd1F66365289b7fe14e503CBB336cD5D13F09">0xE32dd1F66365289b7fe14e503CBB336cD5D13F09</a></li><li>AsyncBancor <a href="https://etherscan.io/address/0xf13b8F103690FD74B5F137eC3CF679a9D1B4BA95">0xf13b8F103690FD74B5F137eC3CF679a9D1B4BA95</a></li><li>AsyncSushiswap <a href="https://etherscan.io/address/0x408Ec47533aEF482DC8fA568c36EC0De00593f44">0x408Ec47533aEF482DC8fA568c36EC0De00593f44</a></li><li>AsyncUniswapV2 <a href="https://etherscan.io/address/0xA780b6A733D06dFf526A84c4258616b75279C763">0xA780b6A733D06dFf526A84c4258616b75279C763</a></li><li>OneInchAggregator <a href="https://etherscan.io/address/0x934D1c4ba7DF902d6cd0803882876e3C999cb406">0x934D1c4ba7DF902d6cd0803882876e3C999cb406</a></li></ul><h5 id="fantom">Fantom</h5><ul><li>ZRX: <a href="https://ftmscan.com/address/0x0a94017DF3f8981Da97D79c28b103bAbDa0D67C7">0x0a94017DF3f8981Da97D79c28b103bAbDa0D67C7</a></li><li>MultiCallOptimizedSwapper: <a href="https://ftmscan.com/address/0x590B3e12Ded77dE66CBF45050cD07a65d1F51dDD">0x590B3e12Ded77dE66CBF45050cD07a65d1F51dDD</a></li><li>AsyncSolidly: <a href="https://ftmscan.com/address/0x2cb391afd5180a31d01bE95Bd61A757594C9295a">0x2cb391afd5180a31d01bE95Bd61A757594C9295a</a></li><li>AsyncSpiritswap: <a href="https://ftmscan.com/address/0x8d2aFF696F14b287a6E759F4bfFB6f08E92DFD20">0x8d2aFF696F14b287a6E759F4bfFB6f08E92DFD20</a></li><li>AsyncSpookyswap: <a href="https://ftmscan.com/address/0x86ee473C2eE7eB97Ee0276bE43427a6CF0cC6348">0x86ee473C2eE7eB97Ee0276bE43427a6CF0cC6348</a></li><li>SyncSpiritswap: <a href="https://ftmscan.com/address/0x923D22FE66C77E2fea215050F088AE26186F96aE">0x923D22FE66C77E2fea215050F088AE26186F96aE</a></li><li>SyncSpookyswap: <a href="https://ftmscan.com/address/0xcD00a47D9fB36B0B37D589E20fE4fB7e2D9d9e8A">0xcD00a47D9fB36B0B37D589E20fE4fB7e2D9d9e8A</a></li></ul><h3 id="trade-factory">Trade Factory</h3><ul><li><p>This contract has the <code>enabled trades</code> that each strategy can make. Enabled trades are just a list of possible swaps that a strategy can make. So it only contains three variables: <code>strategyAddress</code>, <code>tokenIn</code>, <code>tokenOut</code>. We have these enabled trades to know which swaps can/should be made with each strategy.</p></li><li><p>This contract is also in changer of verifying the trades. To do that it will use the different <code>execute</code> methods in it and call the <code>swapper contracts</code> that needs to use. Remember that <code>swappers</code> are the contracts responsible to making the actual swap.</p></li><li><p>When we execute the swap its important to point out that this  takes care of: <code>transfering tokenIn from strat to swapper</code>, <code>make final the check if the amount received &gt; minAmountOut</code>.</p></li></ul><h4 id="trade-factory-contracts-version-020">Trade Factory Contracts (version 0.2.0)</h4><h5 id="ethereum-1">Ethereum</h5><ul><li>TradeFactory: <a href="https://etherscan.io/address/0x7BAF843e06095f68F4990Ca50161C2C4E4e01ec6">0x7BAF843e06095f68F4990Ca50161C2C4E4e01ec6</a></li></ul><h5 id="fantom-1">Fantom</h5><ul><li>TradeFactory: <a href="https://ftmscan.com/address/0xD3f89C21719Ec5961a3E6B0f9bBf9F9b4180E9e9">0xD3f89C21719Ec5961a3E6B0f9bBf9F9b4180E9e9</a></li></ul><h3 id="solvers-scripts">Solvers Scripts</h3><p>Scripts in charge of providing the swap transaction that will be used and sent to <code>Trade Factory contract</code>.</p><ul><li><p><strong>Custom solvers</strong>: There are custom solvers for specific cases/strategies that will need to make multiple transactions for a specific swap. Each of these scripts aims to an specific strategy and trade that needs to be made. Some examples (<code>ThreePoolCrvMulticall.ts</code>). This is for specific strategies&#x27;s trades that will need to swap tokens that can not be swaped/resolved on a single dex swap. The tx provided by this solver is gonna be used with the <code>Multicall swapper</code>.</p></li><li><p><strong>Dexes solvers</strong>: this script is used for situations where the trade can be resolved with a normal swap on an exchange and does NOT require multiple tx to ensure the trade is possible. Different to <code>Custom Solvers</code>, this can be used in a generic way for different strategies/swaps. This script checks with every DeX and chooses the best one to make the trade. The tx provided by this solver is gonna be used with the <code>Single swapper</code>.</p></li><li><p><strong>Multicall Dexes solvers</strong>: This solver is gonna split the trade in different steps using the <code>hopTokens</code> provided by us. Each step of the swap will loop between every dexes library and will take the best dex for each step of the trade. This solver generally will be using the <code>MulticallSwapper</code> since we are doing 2 steps or tx for the swap. But it is also possible to use the <code>SingleSwapper</code> because if both steps of the trade are using the same Dex, we should merge them into one for gas efficiency. We will be transforming <code>2 tx</code> into <code>1 tx</code> so we can use the <code>SingleSwapper</code>.</p></li></ul><br><ul><li><a href="https://github.com/yearn/yswaps-app/tree/main/scripts/libraries/solvers">All Solvers</a></li><li><a href="https://github.com/yearn/yswaps-app/blob/main/scripts/libraries/solvers/Dexes.ts">Dexes Solver</a></li><li><a href="https://github.com/yearn/yswaps-app/blob/main/scripts/libraries/solvers/MulticallDexes.ts">Multicall Dexes Solver</a></li></ul><h3 id="dexes-libraries">Dexes Libraries</h3><p>There is one dex library per dex (uniswap, bancor, ...). They are in charge of getting the trade information of each Dex and returning all the data needed on the <code>Solvers</code>.</p><blockquote><p>NOTE: The libraries contemplate the hopTokens too.</p></blockquote><ul><li><a href="https://github.com/yearn/yswaps-app/tree/main/scripts/libraries/dexes">All Dexes Libraries</a></li><li><a href="https://github.com/yearn/yswaps-app/blob/main/scripts/libraries/dexes/bancor.ts">Bancor Dex Library</a></li><li><a href="https://github.com/yearn/yswaps-app/blob/main/scripts/libraries/dexes/uniswap-v2.ts">UniswapV2 Dex Library</a></li></ul><h3 id="execute-script">Execute script</h3><p>This is where everything starts. Here we will grab all the enabled trades, loop and use logic to determinate if:</p><p>1) Should the trade by executed?<br>
<!-- -->2) If so, what solver should we use?<br>
<!-- -->3) Once we have the solver response, execute the swap transaction provided by the solver.  </p><br><ul><li><a href="https://github.com/yearn/yswaps-app/blob/main/scripts/execute-mainnet-pending-trades.ts">Execute Mainnet pending trades</a></li><li><a href="https://github.com/yearn/yswaps-app/blob/main/scripts/execute-fantom-pending-trades.ts">Execute Fantom pending trades</a></li></ul><h4 id="execute-pending-trades-what-exactly-happens">Execute pending trades: What exactly happens?</h4><ol><li><p>Script execute-mainnet-pending-trades<br>
<!-- -->1.1. Identify &quot;pending trades&quot;<br>
<!-- -->1.2. Determinate which solver to use.<br>
<!-- -->1.3. Solver determinates best Dex and returns the swap tx<br>
<!-- -->1.3. Execute swap tx provided by the solver.  </p></li><li><p>Call the execute in Trade Factory<br>
<!-- -->2.1. Contract validates the data and that trade in configuration is valid.<br>
<!-- -->2.2 Moves the funds directly from the strategy to the swapper.<br>
<!-- -->2.3 Calls <code>swapper.swap()</code> to execute the trade.<br>
<!-- -->2.4 Check that amount received by strategy &gt; minAmountOut provided by us.  </p></li><li><p>Swapper executes the trade<br>
<!-- -->3.1. Validates some data.<br>
<!-- -->3.2. Executes the trade<br>
<!-- -->3.3. Send funds directly to the strategy.  </p></li></ol><h3 id="extra-toolings">Extra toolings</h3><ul><li><strong>Gas service</strong>: provides the correct params for gas options for each network  </li><li><strong>Price service</strong>: we use providers as CoinGecko API to normilize the <code>tokenInAmount</code> and <code>tokenOutAmount</code> in USD so we can verify that we are not getting a bad price from the Dex we ended up using.</li></ul><br><ul><li><a href="https://github.com/yearn/yswaps-app/tree/main/scripts/libraries/utils">Link to services scripts</a></li></ul><h2 id="procedures">Procedures</h2><h3 id="add-new-strategy">Add new strategy</h3><ol><li>Add <code>STRATEGY</code> role on Trade factory contract. From yMech.  </li><li>Add <code>enable trades</code> on Trade factory contract. From strategy.  </li><li>Add <code>enable trade</code> on ySwap repo config (<code>fantom.ts</code> <code>mainnet.ts</code>)<br>3.1 To add it to the config we also need to know what solver we are going to use. It would be <code>Dexes.ts</code> which is a generic solver or it would have its own <code>Custom Solver</code><br>3.2 In case of need a <code>Custom Solver</code>, we need to code it.  </li><li>Once added to config, we are ready to execute the script to swap available trades.  </li></ol><h3 id="remove-strategy">Remove strategy</h3><ol><li>Revoke role from MS.  </li><li>Remove from network config file.  </li><li>OPTIONAL: remove custom solver if it has one.  </li></ol><h2 id="keep3r-jobs">Keep3r jobs</h2><p>Previous knowledge about how <code>Keeper Network</code> works is needed.</p><h3 id="procedures-1">Procedures</h3><h4 id="add-strategy-fantom-keeper-harvest-job">Add strategy fantom keeper harvest job</h4><h5 id="a">A)</h5><ol><li>Go straight to ftmscan harvest job and add the strategy manually by a yMech.  </li><li>Add strategy to v2-ftm-strategies.ts config with <code>added: true</code>  </li></ol><h5 id="b-safest-way-to-have-everything-added">B) (safest way to have everything added)</h5><ol><li>Review and merge pr from strategists to add new strategies.  </li><li>On  packages/strategies-keep3r Execute script: <code>npx hardhat run scripts/jobs/detached/01-v2-harvest-ftm-detached-job-add-strategies.ts --network fantom</code>  </li><li>On config file strategies-keep3r/utils/v2-ftm-strategies.ts change once again  strategies property added to true  </li><li>Push changes.</li></ol><h4 id="remove-strategy-fantom-keeper-harvest-job">Remove strategy fantom keeper harvest job</h4><ol><li>Go to ftmscan <code>Harvest Job SC</code> and remove the strategy manually using method <code>removeStrategies</code>. Call with a mechanic.  </li><li>Remove strategy from <code>v2-NETWORK-strategies.json</code> file.</li></ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"></div><div class="col lastUpdated_vbeJ"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2022-11-24T11:47:44.000Z">11/24/2022</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/developers/v2/fork-yearn-ui"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Fork Yearn UI: create a customized stablecoins-only vaults website</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/developers/v3/overview"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Overview</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#glossary" class="table-of-contents__link toc-highlight">Glossary</a></li><li><a href="#components" class="table-of-contents__link toc-highlight">Components</a><ul><li><a href="#swappers" class="table-of-contents__link toc-highlight">Swappers</a></li><li><a href="#trade-factory" class="table-of-contents__link toc-highlight">Trade Factory</a></li><li><a href="#solvers-scripts" class="table-of-contents__link toc-highlight">Solvers Scripts</a></li><li><a href="#dexes-libraries" class="table-of-contents__link toc-highlight">Dexes Libraries</a></li><li><a href="#execute-script" class="table-of-contents__link toc-highlight">Execute script</a></li><li><a href="#extra-toolings" class="table-of-contents__link toc-highlight">Extra toolings</a></li></ul></li><li><a href="#procedures" class="table-of-contents__link toc-highlight">Procedures</a><ul><li><a href="#add-new-strategy" class="table-of-contents__link toc-highlight">Add new strategy</a></li><li><a href="#remove-strategy" class="table-of-contents__link toc-highlight">Remove strategy</a></li></ul></li><li><a href="#keep3r-jobs" class="table-of-contents__link toc-highlight">Keep3r jobs</a><ul><li><a href="#procedures-1" class="table-of-contents__link toc-highlight">Procedures</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Developers</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://contribute.yearn.rocks/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Open Issues<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.gg/b8ENPNqG5c" target="_blank" rel="noopener noreferrer" class="footer__link-item">#strategies - Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Github</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/yearn/yearn-vaults" target="_blank" rel="noopener noreferrer" class="footer__link-item">yearn-vaults<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/yearn/brownie-strategy-mix" target="_blank" rel="noopener noreferrer" class="footer__link-item">brownie-strategy-mix<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/yearn/brownie-wrapper-mix" target="_blank" rel="noopener noreferrer" class="footer__link-item">brownie-wrapper-mix<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/yearn/yearn-watch" target="_blank" rel="noopener noreferrer" class="footer__link-item">yearn-watch<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/yearn/yearn-finance-v3" target="_blank" rel="noopener noreferrer" class="footer__link-item">yearn-finance-v3<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/yearn/yearn-security" target="_blank" rel="noopener noreferrer" class="footer__link-item">yearn-security<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Ecosystem</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://yearn.fi/vaults" target="_blank" rel="noopener noreferrer" class="footer__link-item">Vaults<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.yfistats.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">YFI Stats<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://bowswap.finance/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Bowswap<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/b8ENPNqG5c" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://x.com/yearnfi" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://t.me/yearnfinance/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Telegram<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://medium.com/iearn" target="_blank" rel="noopener noreferrer" class="footer__link-item">Medium<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://gov.yearn.fi" target="_blank" rel="noopener noreferrer" class="footer__link-item">Forum<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://snapshot.org/#/ybaby.eth" target="_blank" rel="noopener noreferrer" class="footer__link-item">Snapshot voting<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div></div></footer></div>
<script src="/assets/js/runtime~main.6e30f117.js"></script>
<script src="/assets/js/main.3dd8855a.js"></script>
</body>
</html>